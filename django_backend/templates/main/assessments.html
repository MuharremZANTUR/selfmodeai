{% extends 'base.html' %}

{% block title %}DeÄŸerlendirmeler - selfmode.app{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>ðŸ“Š DeÄŸerlendirme GeÃ§miÅŸi</h2>
            <a href="{% url 'main:life_wheel' %}" class="btn btn-primary">
                ðŸ†• Yeni DeÄŸerlendirme
            </a>
        </div>
    </div>
</div>

{% if assessments %}
    <div class="row">
        {% for assessment in assessments %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Test #{{ assessment.test_number }}</h5>
                    <span class="badge bg-primary">{{ assessment.created_at|date:"d.m.Y" }}</span>
                </div>
                <div class="card-body">
                    <!-- Life Areas Summary -->
                    <div class="row text-center mb-3">
                        <div class="col-3">
                            <div class="h6 text-primary">{{ assessment.career }}</div>
                            <small class="text-muted">Kariyer</small>
                        </div>
                        <div class="col-3">
                            <div class="h6 text-success">{{ assessment.health }}</div>
                            <small class="text-muted">SaÄŸlÄ±k</small>
                        </div>
                        <div class="col-3">
                            <div class="h6 text-danger">{{ assessment.relationships }}</div>
                            <small class="text-muted">Ä°liÅŸkiler</small>
                        </div>
                        <div class="col-3">
                            <div class="h6 text-info">{{ assessment.personal_growth }}</div>
                            <small class="text-muted">GeliÅŸim</small>
                        </div>
                    </div>
                    
                    <div class="row text-center mb-3">
                        <div class="col-3">
                            <div class="h6 text-warning">{{ assessment.finances }}</div>
                            <small class="text-muted">Finans</small>
                        </div>
                        <div class="col-3">
                            <div class="h6 text-secondary">{{ assessment.home }}</div>
                            <small class="text-muted">Ev</small>
                        </div>
                        <div class="col-3">
                            <div class="h6 text-success">{{ assessment.fun }}</div>
                            <small class="text-muted">EÄŸlence</small>
                        </div>
                        <div class="col-3">
                            <div class="h6 text-dark">{{ assessment.spirituality }}</div>
                            <small class="text-muted">Maneviyat</small>
                        </div>
                    </div>
                    
                    <!-- Average Score -->
                    <div class="text-center mb-3">
                        <div class="h4 text-primary">
                            {% widthratio assessment.career|add:assessment.health|add:assessment.relationships|add:assessment.personal_growth|add:assessment.finances|add:assessment.home|add:assessment.fun|add:assessment.spirituality 8 1 %}
                        </div>
                        <small class="text-muted">Ortalama Puan</small>
                    </div>
                    
                    <!-- Goals -->
                    {% if assessment.goal1 or assessment.goal2 or assessment.goal3 %}
                    <div class="mt-3">
                        <h6>ðŸŽ¯ Hedefler:</h6>
                        <ul class="list-unstyled">
                            {% if assessment.goal1 %}
                                <li><small>â€¢ {{ assessment.goal1 }}</small></li>
                            {% endif %}
                            {% if assessment.goal2 %}
                                <li><small>â€¢ {{ assessment.goal2 }}</small></li>
                            {% endif %}
                            {% if assessment.goal3 %}
                                <li><small>â€¢ {{ assessment.goal3 }}</small></li>
                            {% endif %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                <div class="card-footer">
                    <small class="text-muted">
                        {{ assessment.created_at|date:"d.m.Y H:i" }} tarihinde oluÅŸturuldu
                    </small>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Progress Chart -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">ðŸ“ˆ Ä°lerleme GrafiÄŸi</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="position: relative; height:400px;">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
{% else %}
    <div class="text-center py-5">
        <div class="h1 text-muted mb-3">ðŸ“Š</div>
        <h4>HenÃ¼z deÄŸerlendirme yapmadÄ±nÄ±z</h4>
        <p class="text-muted mb-4">Ä°lk yaÅŸam Ã§arkÄ± deÄŸerlendirmenizi yaparak baÅŸlayÄ±n!</p>
        <a href="{% url 'main:life_wheel' %}" class="btn btn-primary btn-lg">
            ðŸŽ¯ Ä°lk DeÄŸerlendirmeyi Yap
        </a>
    </div>
{% endif %}
{% endblock %}

{% block extra_js %}
{% if assessments %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('progressChart').getContext('2d');
    
    // Prepare data for chart
    const labels = [];
    const careerData = [];
    const healthData = [];
    const relationshipsData = [];
    const personalGrowthData = [];
    const financesData = [];
    const homeData = [];
    const funData = [];
    const spiritualityData = [];
    
    {% for assessment in assessments %}
        labels.push('Test #{{ assessment.test_number }}');
        careerData.push({{ assessment.career }});
        healthData.push({{ assessment.health }});
        relationshipsData.push({{ assessment.relationships }});
        personalGrowthData.push({{ assessment.personal_growth }});
        financesData.push({{ assessment.finances }});
        homeData.push({{ assessment.home }});
        funData.push({{ assessment.fun }});
        spiritualityData.push({{ assessment.spirituality }});
    {% endfor %}
    
    // Reverse arrays to show oldest first
    labels.reverse();
    careerData.reverse();
    healthData.reverse();
    relationshipsData.reverse();
    personalGrowthData.reverse();
    financesData.reverse();
    homeData.reverse();
    funData.reverse();
    spiritualityData.reverse();
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Kariyer',
                    data: careerData,
                    borderColor: 'rgb(54, 162, 235)',
                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
                    tension: 0.1
                },
                {
                    label: 'SaÄŸlÄ±k',
                    data: healthData,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    tension: 0.1
                },
                {
                    label: 'Ä°liÅŸkiler',
                    data: relationshipsData,
                    borderColor: 'rgb(255, 99, 132)',
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    tension: 0.1
                },
                {
                    label: 'KiÅŸisel GeliÅŸim',
                    data: personalGrowthData,
                    borderColor: 'rgb(255, 159, 64)',
                    backgroundColor: 'rgba(255, 159, 64, 0.1)',
                    tension: 0.1
                },
                {
                    label: 'Finans',
                    data: financesData,
                    borderColor: 'rgb(255, 205, 86)',
                    backgroundColor: 'rgba(255, 205, 86, 0.1)',
                    tension: 0.1
                },
                {
                    label: 'Ev',
                    data: homeData,
                    borderColor: 'rgb(153, 102, 255)',
                    backgroundColor: 'rgba(153, 102, 255, 0.1)',
                    tension: 0.1
                },
                {
                    label: 'EÄŸlence',
                    data: funData,
                    borderColor: 'rgb(201, 203, 207)',
                    backgroundColor: 'rgba(201, 203, 207, 0.1)',
                    tension: 0.1
                },
                {
                    label: 'Maneviyat',
                    data: spiritualityData,
                    borderColor: 'rgb(102, 187, 106)',
                    backgroundColor: 'rgba(102, 187, 106, 0.1)',
                    tension: 0.1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 10
                }
            },
            plugins: {
                legend: {
                    position: 'top'
                }
            }
        }
    });
});
</script>
{% endif %}
{% endblock %}
